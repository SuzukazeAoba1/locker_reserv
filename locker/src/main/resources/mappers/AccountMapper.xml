<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.globalin.locker.mapper.AccountMapper">

    <!-- 매핑 -->
    <resultMap id="AccountResultMap" type="com.globalin.locker.domain.Account">
        <id     property="id"           column="ID"/>
        <result property="username"     column="USERNAME"/>
        <result property="password"     column="PASSWORD"/>
        <result property="role"         column="ROLE"/>
        <result property="email"        column="EMAIL"/>
        <result property="phoneNumber"  column="PHONE_NUMBER"/>
        <result property="isActive"     column="IS_ACTIVE"  jdbcType="CHAR"/>
        <result property="createdAt"    column="CREATED_AT"/>
    </resultMap>

    <!-- 공통 컬럼 목록 -->
    <sql id="Account_Columns">
        ID, USERNAME, PASSWORD, "ROLE" AS ROLE, EMAIL, PHONE_NUMBER, IS_ACTIVE, CREATED_AT
    </sql>

    <!-- Read: 전체 -->
    <select id="selectAll" resultMap="AccountResultMap">
        SELECT <include refid="Account_Columns"/> FROM ACCOUNTS ORDER BY ID
    </select>

    <!-- Read: 단건 -->
    <select id="selectById" parameterType="long" resultMap="AccountResultMap">
        SELECT <include refid="Account_Columns"/> FROM ACCOUNTS WHERE ID = #{id}
    </select>

    <!-- username으로 조회 -->
    <select id="selectByUsername" parameterType="string" resultMap="AccountResultMap">
        SELECT <include refid="Account_Columns"/> FROM ACCOUNTS WHERE USERNAME = #{username}
    </select>

    <!-- Create: ID는 Oracle 12c+ IDENTITY(내부 ISEQ$)에 맡김.
         created_at은 DEFAULT CURRENT_TIMESTAMP를 사용하므로 컬럼에서 제외 -->
    <insert id="insert"
            parameterType="com.globalin.locker.domain.Account"
            useGeneratedKeys="true" keyProperty="id" keyColumn="ID">
        INSERT INTO ACCOUNTS
        (USERNAME, PASSWORD, ROLE, EMAIL, PHONE_NUMBER, IS_ACTIVE)
        VALUES
        (#{username}, #{password}, #{role}, #{email}, #{phoneNumber}, #{isActive})
    </insert>

    <!-- Update: 전체 컬럼 수정(필요 시 동적 <set>으로 바꿔도 됨) -->
    <update id="updateAccount" parameterType="com.globalin.locker.domain.Account">
        UPDATE ACCOUNTS
        SET USERNAME        = #{username},
        "ROLE"              = #{role},
        EMAIL               = #{email},
        PHONE_NUMBER        = #{phoneNumber},
        IS_ACTIVE           = #{isActive, jdbcType=CHAR}
        WHERE ID            = #{id}
    </update>

    <!-- Delete -->
    <delete id="deleteById" parameterType="long">
        DELETE FROM ACCOUNTS WHERE ID = #{id}
    </delete>

</mapper>
